name: listmonk
reset_timeout: 60000
environment_ready_timeout: 300000
datasets:
- name: base
  description: Base dataset with admin credentials
  variables:
    username: admin
    password: password
    wrong_password: wrongpassword
  flows:
  - login
  - incorrect_login
flows:
- name: login
  description: Standard login flow for Listmonk
  steps:
  - action: wait
    duration: 8000
    description: Wait for page to fully load
  - action: wait_for_selector
    selector: 'a:has-text("Login")'
    timeout: 15000
    description: Wait for "Login" span to appear
  - action: click
    selector: 'a:has-text("Login")'
    description: Click login button
  - action: wait_for_selector
    selector: 'input[name="username"], input[name="email"], input[type="email"], #login, .o_field_widget input[type="text"]'
    description: Wait for email/login field
    timeout: 15000
  - action: fill
    selector: 'input[name="username"], input[name="email"], input[type="email"], #login, .o_field_widget input[type="text"]'
    value: $username
    description: Fill email/login field
  - action: wait_for_selector
    selector: 'input[name="password"], input[type="password"], #password, .o_field_widget input[type="password"]'
    description: Wait for password field
    timeout: 15000
  - action: fill
    selector: 'input[name="password"], input[type="password"], #password, .o_field_widget input[type="password"]'
    value: $password
    description: Fill password field
  - action: click
    selector: 'button[type="submit"], input[type="submit"], .btn-primary, .o_login_btn'
    description: Click login submit button
  - action: wait
    duration: 8000
    description: Wait for page to fully load
  - action: verify_no_errors
    description: Verify no login errors are displayed
    error_selectors:
    - .alert-danger
    - .alert-error
    - .error-message
    - .invalid-feedback
    - .login-error
    - .auth-error
    - .error
    - .alert
    - .o_error_detail
  - action: verify
    type: element_exists
    selector: 'span:has-text("Dashboard")'
    description: Verify successful login by checking for main Listmonk interface elements and Todo specific elements
  - action: verify_url
    url: '/admin'
    contains: true
    description: Verify redirected to dashboard
  - action: verify
    type: element_exists
    selector: 'a:has-text("Campaigns"), a:has-text("Subscribers"), a:has-text("Templates"), nav a[href*="/campaigns"], nav a[href*="/subscribers"]'
    description: Verify key navigation items are present
  - action: verify
    type: page_title
    title: 'listmonk'
    contains: true
    description: Verify page title indicates Listmonk
- name: incorrect_login
  description: Verify login fails with incorrect password
  steps:
  - action: wait
    duration: 8000
    description: Wait for page to fully load
  - action: wait_for_selector
    selector: 'a:has-text("Login")'
    timeout: 15000
    description: Wait for "Login" span to appear
  - action: click
    selector: 'a:has-text("Login")'
    description: Click login button
  - action: wait_for_selector
    selector: 'input[name="username"], input[name="email"], input[type="email"], #login, .o_field_widget input[type="text"]'
    description: Wait for email/login field
    timeout: 15000
  - action: fill
    selector: 'input[name="username"], input[name="email"], input[type="email"], #login, .o_field_widget input[type="text"]'
    value: $username
    description: Fill email/login field
  - action: wait_for_selector
    selector: 'input[name="password"], input[type="password"], #password, .o_field_widget input[type="password"]'
    description: Wait for password field
    timeout: 15000
  - action: fill
    selector: 'input[name="password"], input[type="password"], #password, .o_field_widget input[type="password"]'
    value: $wrong_password
    description: Fill password field with incorrect password
  - action: click
    selector: 'button[type="submit"], input[type="submit"], .btn-primary, .o_login_btn'
    description: Click login submit button
  - action: wait
    duration: 1000
    description: Wait for page to fully load
  - action: verify
    type: element_exists
    selector: 'span:has-text("Invalid login or password")'
    description: Verify error message is displayed