name: paperless
reset_timeout: 60000
environment_ready_timeout: 300000
datasets:
- name: base
  description: Base dataset with admin credentials
  variables:
    username: admin
    password: password
    wrong_password: wrongpassword
  flows:
  - login
  - incorrect_login
flows:
- name: login
  description: Complete login flow for Paperless-ngx with verification
  steps:
  - action: wait
    description: Wait for page to fully load
    duration: 3000
  - action: wait_for_selector
    description: Wait for username field
    selector: 'input[name="username"], input[name="login"], #id_username'
    timeout: 15000
  - action: fill
    description: Fill username field
    selector: 'input[name="username"], input[name="login"], #id_username'
    value: $username
  - action: wait_for_selector
    description: Wait for password field
    selector: 'input[name="password"], #id_password, input[type="password"]'
    timeout: 10000
  - action: fill
    description: Fill password field
    selector: 'input[name="password"], #id_password, input[type="password"]'
    value: $password
  - action: wait_for_selector
    description: Wait for login button
    selector: 'button[type="submit"], input[type="submit"], .btn-primary'
    timeout: 10000
  - action: click
    description: Click login button
    selector: 'button[type="submit"], input[type="submit"], .btn-primary'
  - action: wait
    description: Wait for login to process and redirect
    duration: 5000
  - action: verify_no_errors
    description: Verify no login errors displayed
    error_selectors:
      - '.alert-danger'
      - '.alert-error'
      - '.error'
      - '.invalid-feedback'
      - '.errorlist'
  - action: verify_url
    description: Verify redirected to dashboard/home
    url: '/'
    contains: true
  - action: verify
    description: Verify main navigation present
    selector: '.navbar, .sidebar, nav'
    type: element_exists
  - action: verify
    description: Verify dashboard navigation active
    selector: '.nav-link.active, [routerlink="dashboard"]'
    type: element_exists
  - action: verify
    description: Verify authenticated user dropdown present
    selector: '#userDropdown, .dropdown-toggle'
    type: element_exists
  - action: verify
    description: Verify page title indicates Paperless
    title: 'Paperless'
    contains: true
    type: page_title
- name: incorrect_login
  description: Verify login fails with incorrect password
  steps:
  - action: wait
    description: Wait for page to fully load after navigation
    duration: 5000
  - action: wait_for_selector
    description: Wait for username field
    selector: 'input[name="login"], #inputUsername, input[type="text"]'
    timeout: 15000
  - action: fill
    description: Fill username field
    selector: 'input[name="login"], #inputUsername, input[type="text"]'
    value: $username
  - action: wait_for_selector
    description: Wait for password field
    selector: 'input[name="password"], #inputPassword, input[type="password"]'
    timeout: 5000
  - action: fill
    description: Fill password field with incorrect password
    selector: 'input[name="password"], #inputPassword, input[type="password"]'
    value: $wrong_password
  - action: click
    description: Click login button
    selector: 'button[type="submit"], input[type="submit"], .btn-primary'
  - action: wait
    description: Wait for login attempt to process
    duration: 3000
  - action: verify_url
    description: Verify still on login route after incorrect login
    url: '/accounts/login'
    contains: true
  - action: verify
    description: Verify page shows Forbidden title
    title: 'Forbidden'
    contains: true
    type: page_title
  - action: verify
    description: Verify CSRF error is displayed
    selector: 'h1:has-text("Forbidden"), body:has-text("CSRF verification failed")'
    type: element_exists
