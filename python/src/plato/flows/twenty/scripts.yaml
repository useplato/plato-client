name: twenty
reset_timeout: 60000
environment_ready_timeout: 300000
datasets:
- name: base
  description: Base dataset with admin credentials
  variables:
    username: plato@gmail.com
    password: password
    wrong_password: wrongpassword
  flows:
  - login
  - incorrect_login
flows:
- name: login
  description: Complete login flow for Twenty CRM (Plato UI)
  steps:
  - action: wait
    description: Wait for login modal to appear
    duration: 5000
  - action: wait_for_selector
    description: Wait for Continue with Email button
    selector: 'button:has-text("Continue with Email")'
    timeout: 15000
  - action: click
    description: Click "Continue with Email" button on Plato modal
    selector: 'button:has-text("Continue with Email")'
  - action: wait
    description: Wait for email input to appear
    duration: 2000
  - action: wait_for_selector
    description: Wait for email input field
    selector: 'input[placeholder="Email"]'
    timeout: 10000
  - action: fill
    description: Fill in email
    selector: 'input[placeholder="Email"]'
    value: $username
  - action: wait_for_selector
    description: Wait for continue/submit button
    selector: 'button:has-text("Continue"), button[type="submit"]'
    timeout: 10000
  - action: click
    description: Submit email to proceed
    selector: 'button:has-text("Continue"), button[type="submit"]'
  - action: wait
    description: Wait for password screen
    duration: 2000
  - action: wait_for_selector
    description: Wait for password input field
    selector: 'input[type="password"], input[name="password"]'
    timeout: 5000
  - action: fill
    description: Fill in password
    selector: 'input[type="password"], input[name="password"]'
    value: $password
  - action: wait_for_selector
    description: Wait for login button
    selector: 'button:has-text("Log in"), button[type="submit"]'
    timeout: 10000
  - action: click
    description: Click login button
    selector: 'button:has-text("Log in"), button[type="submit"]'
  - action: wait
    description: Wait for login to process
    duration: 5000
  - action: wait
    description: Final wait for dashboard or redirect
    duration: 5000
  - action: verify_no_errors
    description: Verify no errors visible after login
    error_selectors:
    - .alert-danger
    - .alert-error
    - .error-message
    - .invalid-feedback
    - .login-error
    - .auth-error
    - .error
    - .alert
  - action: verify_url
    description: Verify redirected to book call decision (post-login)
    url: '/book'
    contains: true
  - action: verify
    description: Verify workspace dropdown present (authenticated UI)
    selector: '[data-testid="workspace-dropdown"]'
    type: element_exists
  - action: verify
    description: Verify navigation/sidebar present
    selector: 'nav, [role="navigation"], aside, [class*="sidebar"], [data-testid*="sidebar"]'
    type: element_exists
  - action: verify
    description: Verify page title indicates Twenty
    title: 'Twenty'
    contains: true
    type: page_title
  - action: wait_for_selector
    description: Wait for Finish button to appear
    selector: 'button:has-text("Finish"), [aria-label*="Finish"], [data-testid*="finish"]'
    timeout: 10000
  - action: click
    description: Click Finish to avoid onboarding booking
    selector: 'button:has-text("Finish"), [aria-label*="Finish"], [data-testid*="finish"]'
  - action: wait
    description: Wait for post-finish navigation to settle
    duration: 2000
- name: incorrect_login
  description: Verify login fails with incorrect password
  steps:
  - action: wait
    description: Wait for login modal to appear
    duration: 5000
  - action: click
    description: Click "Continue with Email" button
    selector: 'button:has-text("Continue with Email")'
  - action: wait
    description: Wait for email input to appear
    duration: 2000
  - action: fill
    description: Fill in email
    selector: 'input[placeholder="Email"]'
    value: $username
  - action: click
    description: Submit email to proceed
    selector: 'button:has-text("Continue"), button[type="submit"]'
  - action: wait
    description: Wait for password screen
    duration: 2000
  - action: fill
    description: Fill in incorrect password
    selector: 'input[type="password"], input[name="password"]'
    value: $wrong_password
  - action: click
    description: Click login button
    selector: 'button:has-text("Log in"), button[type="submit"]'
  - action: wait
    description: Wait for login attempt to process
    duration: 3000
  - action: verify
    description: Verify error message is displayed
    selector: '[data-testid="error-message"], .MuiAlert-root, .MuiAlert-standardError, .error-message, [data-testid*="error"], .form-error, .text-danger, [class*="error"], [role="alert"], [class*="alert"], [class*="danger"], .warning, .fail, .invalid'
    type: element_exists
