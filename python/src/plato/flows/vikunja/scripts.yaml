name: vikunja
reset_timeout: 60000
environment_ready_timeout: 300000
datasets:
- name: base
  description: Base dataset with admin credentials
  variables:
    username: admin
    password: password
    wrong_password: wrongpassword
  flows:
  - login
  - incorrect_login
flows:
- name: login
  description: Complete login flow with verification
  steps:
  - action: wait
    description: Wait for page to fully load
    duration: 5000
  - action: wait_for_selector
    description: Wait for username field
    selector: 'input[name="username"], input[type="text"], #username, input[placeholder*="username"], input[placeholder*="Username"]'
    timeout: 15000
  - action: fill
    description: Fill username field
    selector: 'input[name="username"], input[type="text"], #username, input[placeholder*="username"], input[placeholder*="Username"]'
    value: $username
  - action: wait_for_selector
    description: Wait for password field
    selector: 'input[name="password"], input[type="password"], #password'
    timeout: 5000
  - action: fill
    description: Fill password field
    selector: 'input[name="password"], input[type="password"], #password'
    value: $password
  - action: wait_for_selector
    description: Wait for login button to be ready
    selector: 'button[type="submit"], input[type="submit"], .btn-primary, .login-button, button:has-text("Login"), button:has-text("Sign in"), button.button'
    timeout: 5000
  - action: click
    description: Click login button
    selector: 'button[type="submit"], input[type="submit"], .btn-primary, .login-button, button:has-text("Login"), button:has-text("Sign in"), button.button'
  - action: wait
    description: Wait for login to process
    duration: 5000
  - action: verify_url
    description: Verify redirected to tasks route
    url: '/'
    contains: true
  - action: verify
    description: Verify navigation frame is present
    selector: 'nav, .navbar, .sidebar, [data-cy="navigation"], [class*="navigation"], [class*="sidebar"]'
    type: element_exists
  - action: verify
    description: Verify key nav links exist
    selector: 'a[href*="/projects"], a[href*="/lists"], a[href*="/tasks"], [data-cy*="project"], [data-cy*="list"]'
    type: element_exists
  - action: verify
    description: Verify page title indicates Vikunja
    title: 'Vikunja'
    contains: true
    type: page_title
- name: incorrect_login
  description: Verify login fails with incorrect password
  steps:
  - action: wait
    description: Wait for page to fully load
    duration: 5000
  - action: wait_for_selector
    description: Wait for username field
    selector: 'input[name="username"], input[type="text"], #username, input[placeholder*="username"], input[placeholder*="Username"]'
    timeout: 15000
  - action: fill
    description: Fill username field
    selector: 'input[name="username"], input[type="text"], #username, input[placeholder*="username"], input[placeholder*="Username"]'
    value: $username
  - action: wait_for_selector
    description: Wait for password field
    selector: 'input[name="password"], input[type="password"], #password'
    timeout: 5000
  - action: fill
    description: Fill password field with incorrect password
    selector: 'input[name="password"], input[type="password"], #password'
    value: $wrong_password
  - action: wait_for_selector
    description: Wait for login button to be ready
    selector: 'button[type="submit"], input[type="submit"], .btn-primary, .login-button, button:has-text("Login"), button:has-text("Sign in"), button.button'
    timeout: 5000
  - action: click
    description: Click login button
    selector: 'button[type="submit"], input[type="submit"], .btn-primary, .login-button, button:has-text("Login"), button:has-text("Sign in"), button.button'
  - action: wait
    description: Wait for login attempt to process
    duration: 3000
  - action: verify
    description: Verify error message is displayed
    selector: '.error, .alert-danger, .alert-error, [role="alert"], .message.negative, .notification.is-danger, .notification.is-error, [class*="error"], [class*="danger"]'
    type: element_exists
